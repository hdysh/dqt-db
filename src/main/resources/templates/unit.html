<!DOCTYPE html>

<!--  main-fragment (title, otherStaticResources, header, nav, mainContent, footer)  -->
<html xmlns:th="http://www.thymeleaf.org"
	th:replace="~{main-layout :: main-fragment(  
                                                ~{::title},
                                                ~{:: #unit-static-resources},
                                                ~{:: #unit-header},
                                                ~{:: #unit-nav},
                                                ~{:: #unit-content},  
                                                ~{:: #unit-footer}
                                               )}">

<head>
<title th:text="#{${unit.name}}"></title>

<th:block id="unit-static-resources">
	<script src="https://code.jquery.com/jquery-3.6.0.slim.js"
		type="text/javascript"></script>
	<link rel="stylesheet" type="text/css" th:href="@{/css/unit.css}"
		href="../static/css/unit.css" />
	<script>
		var pass  = [(${passAdd})]  ;
		var stats = [(${stats})];
		var rank = 7;
		var awak = 0;
		var awakAdd = [(${awaAdd})];
		var awakMul = [(${awaMul})];
		var masterStats = [(${master})];
		var master = 0;
		var talentStats = [(${talentStats})];
		var awakening = [(${awakening})];
		var fullTalent = false;

		function applyStats() {
		    var level = stats[rank].level; 
		    $('#lvl').text(': ' + (stats[rank].level + (awakAdd[awak] ? awakAdd[awak].level : 0) + (pass[level] ? pass[level].level : 0)));
		    $('#hp').text(': ' + mul((stats[rank].hp + (awakAdd[awak] ? awakAdd[awak].hp : 0) + (pass[level] ? pass[level].hp : 0) + (fullTalent ? talentStats.hp : 0)), awakMul[awak].hp, masterStats[master].hp));
		    $('#mp').text(': ' + mul((stats[rank].mp + (awakAdd[awak] ? awakAdd[awak].mp : 0) + (pass[level] ? pass[level].mp : 0) + (fullTalent ? talentStats.mp : 0)), awakMul[awak].mp, masterStats[master].mp));
		    $('#atk').text(': ' + mul((stats[rank].attack + (awakAdd[awak] ? awakAdd[awak].attack : 0) + (pass[level] ? pass[level].attack : 0) + (fullTalent ? talentStats.attack : 0)), awakMul[awak].attack, masterStats[master].attack));
		    $('#def').text(': ' + mul((stats[rank].defense + (awakAdd[awak] ? awakAdd[awak].defense : 0) + (pass[level] ? pass[level].defense : 0) + (fullTalent ? talentStats.defense : 0)), awakMul[awak].defense, masterStats[master].defense));
		    $('#agi').text(': ' + mul((stats[rank].agility + (awakAdd[awak] ? awakAdd[awak].agility : 0) + (pass[level] ? pass[level].agility : 0) + (fullTalent ? talentStats.agility : 0)), awakMul[awak].agility, masterStats[master].agility));
		    $('#int').text(': ' + mul((stats[rank].intelligence + (awakAdd[awak] ? awakAdd[awak].intelligence : 0) + (pass[level] ? pass[level].intelligence : 0) + (fullTalent ? talentStats.intelligence : 0)), awakMul[awak].intelligence, masterStats[master].intelligence));
		    $('#mov').text(': ' + (stats[rank].mobility + (awakAdd[awak] ? awakAdd[awak].mobility : 0) + (pass[level] ? pass[level].mobility : 0) + (fullTalent ? talentStats.mobility : 0)));
		  
		    for(let i=0;i<Object.keys(awakening).length;i++){
		    	if(i<=awak){
					setEleres(awakening[i] );  
				}
		    }
		}  
		function setEleres(res ){ 
			 for(let j=1;j<=7;j++){ 
				let ele= $('#ele'+j ); 
				let value=ele.data("val")+res["ele"+j];
				ele.text(value);
				console.log(value+" - "+resLevel(value));
				 $('#imgele'+j ).attr('src','/img/icon/'+resLevel(value)); 
			 }
		} 
		function mul(val, mul1, mul2) {
		    return Math.floor(val + (val * (mul1 + mul2) / 100));
		}
		function resLevel(val) {
			let output;
	    let res = [{
	            "min": -2147483648,
	            "max": -6666,
	            "icon": "ResistanceLevel_ChouZyakuten.png"
	        },
	        {
	            "min": -6666,
	            "max": -3333,
	            "icon": "ResistanceLevel_DaiZyakuten.png"
	        },
	        {
	            "min": -3333,
	            "max": 0,
	            "icon": "ResistanceLevel_Zyakuten.png"
	        },
	        {
	            "min": 0,
	            "max": 1,
	            "icon": "ResistanceLevel_Hutuu.png"
	        },
	        {
	            "min": 1,
	            "max": 3334,
	            "icon": "ResistanceLevel_Keigen.png"
	        },
	        {
	            "min": 3334,
	            "max": 6667,
	            "icon": "ResistanceLevel_Hangen.png"
	        },
	        {
	            "min": 6667,
	            "max": 10000,
	            "icon": "ResistanceLevel_Gekigen.png"
	        },
	        {
	            "min": 10000,
	            "max": 2147483647,
	            "icon": "ResistanceLevel_Mukou.png"
	        }
	    ]
	    for (i = 0; i < res.length; i++) {
	        if (val >= res[i].min && val < res[i].max) {
	        	output=res[i].icon;
	        }
	    }
	    return output;
	} 
		$(document).ready(function() {
			
		    applyStats();
		    $("#rankSelect").on("change", function() {
		        rank = $(this).val();
		        applyStats();
		    });
		    $("#awakeningSelect").on("change", function() {
		        awak = $(this).val();
		        applyStats();
		    });
		    $("#masterSelect").on("change", function() {
		        master = $(this).val();
		        applyStats();
		    });
		    if ($("#talent").is(":checked")) {
		        fullTalent = true;
		        applyStats();
		    } else {
		        fullTalent = false;
		        applyStats();
		    }
		    $("#talent").change(function() {
		        if ($(this).is(":checked")) {
		            fullTalent = true;
		            applyStats();
		        } else {
		            fullTalent = false;
		            applyStats();
		        }
		    });
		});

		window.onload = function() {
		    form1.reset();
		}
	</script>
</th:block>

</head>
<body>

	<div th:text="#{${unit.name}}" id="unit-header"></div>

	<div id="unit-nav"
		th:replace="~{fragments/app-fragments :: nav-default}">Nav</div>

	<div id="unit-content">

		<div class="content">
			<div class="grid-container">
				<div class="pp">
					<div class="pp-inner">
						<div class="unit-profile">
							<div
								th:style="'display: flex;flex-direction: row; padding:4px 0;height: 30px;'">
								<div>
									<img th:src="@{${'/img/icon/' + unit.family.icon }}" />
								</div>
								<div>
									<img th:style="'height:30px;'"
										th:src="@{${'/img/icon/' + unit.role.icon }}" />
								</div>
							</div>
							<div class="frame-container">
								<div class="framez">
									<img th:src="@{${'/img/icon/' + unit.rarity.background }}" />
								</div>
								<div class="prof">
									<img th:src="@{${'/img/icon/' + unit.icon }}" />

								</div>
								<div class="framez">
									<img th:src="@{${'/img/icon/' + unit.rarity.frame }}" />
								</div>
								<div class="rarity">
									<img th:src="@{${'/img/icon/' + unit.rarity.icon }}" />
								</div>

							</div>
							<div th:style="' '">
								<div th:text="#{${unit.name}}"
									th:style="'text-align: center;font-size:25px;font-weight:bold;'">
								</div>
							</div>
						</div>
					</div>
				</div>
				<div class="ld" th:if="${unit.leader}">
					<div class="header bold">Leader Skill</div>
					<a class="leader-item" th:href="@{${'/passive/' + unit.leader.code }}" th:text="#{${unit.leader.name}}"></a>
					<div class="leader_container">
						<img th:src="@{${'/img/icon/' + unit.leader.leadericon }}" />
					</div>
					<div class="leader-item" th:text="#{${unit.leader.description}}"></div>

				</div>
				<div class="ss">

					<div class="stats_item_cont bold">
						<span class="stats_item">LVL</span>
						<span class="stats_item val" id="lvl"
							th:text="${ ': '+ unit.stats[7].level}"></span>
					</div>
					<div class="stats_item_cont bold">
						<span class="stats_item">HP</span>
						<span class="stats_item val" id="hp"
							th:text="${ ': '+ unit.stats[7].hp}"></span>
					</div>
					<div class="stats_item_cont bold">
						<span class="stats_item">MP</span>
						<span class="stats_item val" id="mp"
							th:text="${ ': '+ unit.stats[7].mp}"></span>
					</div>
					<div class="stats_item_cont bold">
						<span class="stats_item">ATK</span>
						<span class="stats_item val" id="atk"
							th:text="${ ': '+ unit.stats[7].attack}"></span>
					</div>
					<div class="stats_item_cont bold">
						<span class="stats_item">DEF</span>
						<span class="stats_item val" id="def"
							th:text="${ ': '+ unit.stats[7].defense}"></span>
					</div>
					<div class="stats_item_cont bold">
						<span class="stats_item">AGL</span>
						<span class="stats_item val" id="agi"
							th:text="${ ': '+ unit.stats[7].agility}"></span>
					</div>
					<div class="stats_item_cont bold">
						<span class="stats_item">WIS</span>
						<span class="stats_item val" id="int"
							th:text="${ ': '+ unit.stats[7].intelligence}"></span>
					</div>
					<div class="stats_item_cont bold">
						<span class="stats_item">MOV</span>
						<span class="stats_item val" id="mov"
							th:text="${ ': '+ unit.stats[7].mobility}"></span>
					</div>

					<div class="form-group"></div>
					<form name="form1" class="flex_center_row">
						<div class="form-group">
							<select class="form-control" id="rankSelect">
								<option th:each="i: ${#numbers.sequence(0, 7)}"
									th:selected="${i == 7}" th:value="${i}" th:text="${'Rank '+i}"></option>
							</select>
						</div>
						<div class="form-group">
							<select class="form-control" id="awakeningSelect">
								<option th:each="i: ${#numbers.sequence(0, 5)}"
									th:selected="${i == 0}" th:value="${i}"
									th:text="${'Awakening '+i}"></option>
							</select>
						</div>
						<div class="form-group">
							<select class="form-control" id="masterSelect">
								<option th:each="i: ${#numbers.sequence(0, 60)}"
									th:selected="${i == 0}" th:value="${i}"
									th:text="${'Master Rank '+i}"></option>
							</select>
						</div>
						<div th:if="${#lists.size(unit.talents) > 0}">
							<label><input type="checkbox" name="active" id="talent"
								th:checked="false" />Full Talent Blossom</label>
						</div>
					</form>
				</div>
				<div class="sk">
					<div class="skills">
						<div class="header bold">Skills</div>
						<table class="w100">
							<thead>
								<tr>
									<th>Level</th>
									<th>Icon</th>
									<th>Name</th>
									<th>MP</th>
									<th>Element</th>
									<th>Range</th>
									<th>Description</th>
								</tr>
							</thead>
							<tbody>
								<tr th:each="us  : ${unit.skills}">
									<td th:if="${us.level>-1}" th:text="${us.level}">level</td>
									<td th:if="${us.level==-1}"><img th:style="'height:25px;'"
											title="Talent Blossom" src="/img/TrainingPointIcon.png" /></td>
									<td>
										<div
											th:classappend="${us.skill.rarity.code==30} ? skill_frame : skill_frame2"
											th:style="@{${'background-image: url(/img/icon/' + us.skill.button+');' }}">
											<span class="skill_frame_centerer"></span>
											<img th:src="@{${'/img/icon/' + us.skill.icon }}" />
										</div>
									</td>
									<td><a th:href="@{${'/skill/' + us.skill.code }}"
											th:text="#{${us.skill.name}}">name</a></td>
									<td th:text="${us.skill.mp}">mp</td>
									<td><img th:title="#{${us.skill.element.name}}"
											th:src="@{${'/img/icon/' + us.skill.element.icon }}" /></td>
									<td><div class="skill-range">
											<img th:src="@{${'/img/icon/' + us.skill.range }}" />
											<div th:text="#{${us.skill.reach}}"></div>
										</div></td>
									<td th:with="desctr=#{${us.skill.description}}"><div
											th:remove="tag"
											th:with="desc1=${#strings.replace(desctr,'<damagePhysics>',us.skill.strMul)}">
											<div th:remove="tag"
												th:with="desc2=${#strings.replace(desc1,'<specialCoolTurn>',us.skill.turn)}">
												<div th:remove="tag"
													th:if="not ${#lists.isEmpty(us.skill.buffs)}"
													th:with="desc3=${#strings.replace(desc2,'<Turn1>',us.skill.buffs[0].maxDur)}">
													<div th:text="${desc3}">desc</div>
												</div>
												<div th:remove="tag"
													th:if="${#lists.isEmpty(us.skill.buffs)}">
													<div th:text="${desc2}">desc</div>
												</div>
											</div>
										</div></td>
								</tr>
							</tbody>

						</table>
					</div>
				</div>

				<div class="ps" th:if="${unit.passives}">
					<div class="skills">
						<div class="header bold">Passive</div>
						<div class="passive_awak_container" th:if="${unit.passives}">
							<div class="passive-row">
								<div class="passive_item bold passive-level">Level</div>
								<div class="passive_item bold passive-name">Name</div>
								<div class="passive_item bold passive-desc">Description</div>
							</div>

							<div th:each="up,iter : ${unit.passives}" class="passive-row">
								<div class="passive_item passive-level" th:text="${up.level}"></div>
								<div th:with="desctr=#{${up.passive.name}}"
									class="passive_item passive-name">
									<a th:href="@{${'/passive/' + up.passive.code }}"
										th:text="${ desctr.replaceAll('<.+?>', (up.passive.var/100) ).replaceAll('\+-', '-' )}"></a>
								</div>
								<div th:with="desctr=#{${up.passive.description}}"
									class="passive_item passive-desc">
									<div
										th:text="${ desctr.replaceAll('<.+?>', (up.passive.var/100) )}"></div>
								</div>
							</div>
						</div>


					</div>
				</div>

				<div class="ak" th:if="${unit.awakenings}">

					<div class="skills">
						<div class="header bold">Awakening</div>

						<div class="passive_awak_container" th:if="${unit.awakenings}">
							<div class="passive-row">
								<div class="passive_item bold passive-awakening">Awakening</div>
								<div class="passive_item bold passive-name">Name</div>
								<div class="passive_item bold passive-desc">Description</div>
							</div>
							<div th:each="ua,iter : ${unit.awakenings}" class="passive-row">
								<div class="passive_item passive-awakening" th:text="${ua.level}"></div>
								<div th:with="desctr=#{${ua.awakening.name}}"
									class="passive_item passive-name">
									<a th:href="@{${'/passive/' + ua.awakening.code }}"
										th:text="${ desctr.replaceAll('<.+?>', (ua.awakening.var ) ).replaceAll('\+-', '-' )}"></a>
								</div>
								<div th:with="desctr=#{${ua.awakening.description}}"
									class="passive_item passive-desc">
									<div
										th:text="${ desctr.replaceAll('<.+?>', (ua.awakening.var ) )}"></div>
								</div>
							</div>
						</div>


					</div>
				</div>
				<div class="er">
					<div class="resistance">
						<div class="header bold">Element Resistance</div>
						<div th:each="re: ${eleres}" th:remove="tag">
							<div class="res bold w300px res-grid">
								<div class="h30px grid">
									<img class="center self-center"
										th:src="@{${'/img/icon/' +re.ele.icon }}" />
								</div>
								<div class="h30px grid">
									<span class="center self-center" th:text="#{${re.ele.name }}"></span>
								</div>
								<div class="h30px grid">
									<span class="center self-center" th:text="${re.value }"
										th:id="${'ele'+re.ele.code}" th:attr="data-val=${re.value}"></span>
								</div>
								<div class="h30px grid">
									<img class="center self-center"
										th:src="@{${'/img/icon/' + re.icon  }}"
										th:id="${'imgele'+re.ele.code}" />
								</div>
							</div>
						</div>

					</div>
				</div>
				<div class="ar">
					<div class="resistance">
						<div class="header bold w300px">Status Ailment Resistance</div>
						<!-- <div th:each="res: ${unit.ailres.ail1}" class="" th:remove="tag"> -->
						<div th:each="awak,iter : ${strAilment}" th:remove="tag">
							<div class="res bold w300px res-grid">
								<div class="h30px grid">
									<img class="center self-center"
										th:src="@{${'/img/icon/' +ailment.get(awak).icon }}" />
								</div>
								<div class="h30px grid">
									<span class="center self-center"
										th:text="#{${ailment.get(awak).name }}"></span>
								</div>
								<div class="h30px grid">
									<span class="center self-center"
										th:text="${ailres[iter.index].value }"
										th:id="${'ail'+ailment.get(awak).code}"
										th:attr="data-val=${ailres[iter.index].value}"></span>
								</div>
								<div class="h30px grid">
									<img class="center self-center" th:id="${awak}"
										th:src="@{${'/img/icon/' +ailres[iter.index].icon }}" />
								</div>
							</div>
						</div>

					</div>
				</div>

				<div class="dr" th:if="${#lists.size(unit.drops) > 0}">
					<div class="drops">
						<div class="header bold">How to get:</div>
						<div th:each="drop  : ${unit.drops}">
							<div class="drop-loc">
								<div class="drop-top">
									<a
										th:href="${(drop.portalSplit[0] == '1' ? '/event/' : '/event/group/' )+drop.portalSplit[1]}"
										th:text="#{${drop.portalSplit[2]}}"></a>
								</div>
								<div class="drop-bottom">
									<span>➤</span>
									<a th:href="${'/stages/'+drop.stageSplit[0]}"
										th:text="#{${drop.stageSplit[1]}}"></a>
								</div>
							</div>
						</div>
					</div>

				</div>

			</div>

			<div class="container">


				<div class="passive"></div>

			</div>
		</div>
	</div>




	<div id="unit-footer"
		th:replace="~{fragments/app-fragments :: copyright}">Footer</div>


</body>
</html>